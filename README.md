# ë¼ì¦ˆë² ë¦¬íŒŒì´ë¥¼ í™œìš©í•œ ìŠ¤í¬ì¸  ìŠ¤ë§ˆíŠ¸ ê³ ê¸€ ê¸°ìˆ  êµ¬í˜„

## Introduction
* ìì „ê±°ë¥¼ íƒ€ëŠ” ë¼ì´ë”ë‚˜ ë§ˆë¼í†¤ì„ í•˜ëŠ” ëŸ¬ë„ˆë“¤ì€ ì²´ë ¥ì˜ í•œê³„ì¹˜ì—ì„œ ì£¼ìœ„ì˜ ë‹¤ë¥¸ ì´ë“¤ê³¼ ê²½ìŸ
* ì²´ë ¥ì˜ í•œê³„ ìƒí™©ì—ì„œ ì™¸ë¶€ ì •ë³´ë“¤ì„ ìˆ˜ì§‘í•˜ëŠ” ê²ƒì— ë‘”í•´ì§€ëŠ” ìš°ë¦¬ ëª¸ì˜ ê°ê°
* í˜„ì¬ ìƒìš©í™” ë˜ì–´ ìˆëŠ” ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜ì˜ ê²½ìš° ìš´ë™ ì¤‘ì— ì‹œì„ ì„ ì´ë™ì‹œí‚¤ê¸° ë•Œë¬¸ì— ê²½ê¸°ë ¥ê³¼ ì•ˆì „ì— ì˜í–¥ì„ ë¼ì¹¨
* ì´ë¥¼ ëŒ€ì‹ í•  ë³´ì¡° ê°ê°ìœ¼ë¡œ ìŠ¤ë§ˆíŠ¸ ê³ ê¸€ì„ ê³ ì•ˆ



## Concept
* ìë™ì°¨ í›„ë°© ê°ì§€ ì„¼ì„œë¥¼ ë°”íƒ•ìœ¼ë¡œ ê³ ì•ˆ
* ì´ˆìŒíŒŒ ì„¼ì„œë¥¼ ì´ìš©í•˜ì—¬ ê±°ë¦¬ë¥¼ ì¸¡ì •
* ì¸¡ì •í•œ ê±°ë¦¬ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶©ëŒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì†Œë¦¬(Buzzer)ë¥¼ ì œê³µ
* ì¹´ë©”ë¼ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ë¬¼ì„ ì¸ì‹
* ì¸ì‹í•œ ì‚¬ë¬¼ì„ ìŠ¤í”¼ì»¤ë¥¼ í†µí•´ ìŒì„± ì•ˆë‚´


<img width="949" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-11-30 á„‹á…©á„’á…® 4 09 48" src="https://github.com/YoungWoon-Go/sports-smart-goggles-using-raspberry-pie/assets/144092472/28ecdd1e-e2bb-4aab-bf53-c6cc4147d05d">





## Estimated result design

![image](https://github.com/YoungWoon-Go/sports-smart-goggles-using-raspberry-pie/assets/144092472/54dc556d-42d0-4d4a-9ae5-c9f0ff96bbfe)



## Tools used



* Rasberry Pi 3

![image](https://github.com/YoungWoon-Go/sports-smart-goggles-using-raspberry-pie/assets/144092472/51283e18-b8b3-4678-8dc3-f121c378cc27)


* ì´ˆìŒíŒŒ ê±°ë¦¬ ì¸¡ì • ì„¼ì„œ X3

![image](https://github.com/YoungWoon-Go/sports-smart-goggles-using-raspberry-pie/assets/144092472/6cfdf3fb-75f5-4317-bb1b-597f2004f854)



* Passive Buzzer X2

![image](https://github.com/YoungWoon-Go/sports-smart-goggles-using-raspberry-pie/assets/144092472/9eec9001-aa38-4640-8ffc-f0d21bd8558a)


* Pi Camera

![image](https://github.com/YoungWoon-Go/sports-smart-goggles-using-raspberry-pie/assets/144092472/db4a1d04-6869-46e6-977e-03fa46de12b4)



 




## Description

### ì¥ì• ë¬¼ ê°ì§€ ë° ë¶€ì € ì•Œë¦¼
* ì´ˆìŒíŒŒ ì„¼ì„œ 3ê°œë¥¼ ì™¼ìª½, ì˜¤ë¥¸ìª½, ê°€ìš´ë°ì— ìœ„ì¹˜í•˜ì—¬ ê°ê° ê±°ë¦¬ë¥¼ ì¸¡ì •í•˜ë„ë¡ í•¨
* ì‚¬ë¬¼ì´ ê°€ê¹Œì›Œì§ˆìˆ˜ë¡ passive buzzer 2ê°œì—ì„œ ì†Œë¦¬ê°€ ë¹¨ë¼ì§

  ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-11-25 á„‹á…©á„’á…® 3 44 30](https://github.com/YoungWoon-Go/OSS_project/assets/144092472/7e25a499-70c0-4764-949a-06651f2559ac)
  * RED: ì´ˆìŒíŒŒ ê±°ë¦¬ ì¸¡ì • ì„¼ì„œ
  * BLUE: í”¼ì—ì¡° ë¶€ì € ëª¨ë“ˆ
___

 â ì´ˆê¸° ì„¸íŒ…
```c
	int main(void)
 {
	 /* -----set up----- */
	
     if (wiringPiSetup() == -1) {
         return 1;
     }
	
	 if (softToneCreate(LEFT_BUZZER_PIN) != 0 || softToneCreate(RIGHT_BUZZER_PIN) != 0) {
         return 1;
     }
	
     pinMode(TRIGGER_LEFT, OUTPUT);
     pinMode(ECHO_LEFT, INPUT);
     pinMode(TRIGGER_MIDDLE, OUTPUT);
     pinMode(ECHO_MIDDLE, INPUT);
     pinMode(TRIGGER_RIGHT, OUTPUT);
     pinMode(ECHO_RIGHT, INPUT);
```
---
 â ê±°ë¦¬ê°’ì„ ë°›ì•„ì™€ ì¼ì • ê±°ë¦¬ ì•ˆìª½ìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ passive buzzer ì‘ìš©
```c
 digitalWrite(TRIGGER, LOW); 
 usleep(10); 
 digitalWrite(TRIGGER, HIGH); 
 usleep(10); 
 digitalWrite(TRIGGER, LOW); 

 struct timeval start, stop; 
 while (digitalRead(ECHO) == 0) {	 	// í„ìŠ¤ ë°œìƒ
	 gettimeofday(&start, NULL); 
 } 
 while (digitalRead(ECHO) == 1) {	 	// í„ìŠ¤ ëŒì•„ì˜´ 
 	gettimeofday(&stop, NULL); 
 }

 // ë¦¬í„´ íˆ¬ íƒ€ì„ = (endì‹œê°„ - startì‹œê°„) 
 double elapsedTime = (stop.tv_sec - start.tv_sec) * 1000000 + (stop.tv_usec - start.tv_usec); 
 // ì´ˆìŒíŒŒì˜ ê±°ë¦¬ ê°’ 
 double distance = elapsedTime * (34000.0 / 2.0) / 1000000.0; // ì†ë„ë¥¼ cm/usë¡œ ë³€í™˜ 
```
---
 â í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ ì–¸ ë° í•€ ë²ˆí˜¸ ì§€ì •
 
```c
 #include <wiringPi.h>
 #include <unistd.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <stdint.h>
 #include <math.h>
 #include <sys/time.h>   // <sys/time.h> í—¤ë” íŒŒì¼ ì¶”ê°€
 #include <softTone.h>


 // ì™¼ìª½ ì´ˆìŒíŒŒ
 #define TRIGGER_LEFT 27
 #define ECHO_LEFT 28
 // ê°€ìš´ë° ì´ˆìŒíŒŒ
 #define TRIGGER_MIDDLE 10
 #define ECHO_MIDDLE 11
 // ì˜¤ë¥¸ìª½ ì´ˆìŒíŒŒ
 #define TRIGGER_RIGHT 15
 #define ECHO_RIGHT 16 

 // buzzer ì™¼ìª½, ì˜¤ë¥¸ìª½
 #define LEFT_BUZZER_PIN 30
 #define RIGHT_BUZZER_PIN 8

 // 40cm ì´ë‚´ë¶€í„° buzzer ì‘ë™
 #define TRIGGER_THRESHOLD 40 

 // ê±°ë¦¬ì— ë”°ë¼ delay (ê°€ê¹Œìš¸ìˆ˜ë¡ ë¹¨ë¦¬) -> ì´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ìˆœê°„ ë¶€ì € ì‘ë™X
 void delayByDistance(double distance)
 {
     int delayTime = (int)distance / 100;
     delay(delayTime);
 }
```
---
 â ê±°ë¦¬ì— ë”°ë¼ ì†Œë¦¬ì˜ ë†’ë‚®ì´ì™€ ë¹ˆë„ ìˆ˜ë¥¼ ì¡°ì ˆí•˜ì—¬ passive buzzerì„ ìš¸ë¦¬ëŠ” ì½”ë“œ
 
 ```c
 // ë¶€ì € ìš¸ë¦¬ê¸°
	 void playBuzzer(int buzzerPin, double distance) {
     int frequency;
     int delaytime;
     // int delaytime = (int)distance/100;

     if (distance <= 40 && distance > 25) {
         frequency = 700;
         delaytime = 300;
     } else if (distance <= 25 && distance > 10) {
         frequency = 1000;
         delaytime = 150;
     } else if (distance <= 10) {
         frequency = 3000;
         delaytime = 50;
     } else {
         frequency = 0;
         delaytime = 0;
     }

	 // softToneWrite(gpio pin num, ì£¼íŒŒìˆ˜ í†¤(ìˆ«ì))
	
     softToneWrite(buzzerPin, frequency);
     delay(delaytime);	// ì†Œë¦¬ ê¸¸ì´
     //delayByDistance(distance);
    
     softToneWrite(buzzerPin, 0);
     delay(delaytime);
     //delayByDistance(distance);
 }
```
---

â ì´ˆìŒíŒŒ ì„¼ì„œë¡œ ê±°ë¦¬ ì¸¡ì •, passive buzzerì„ ìš¸ë¦¬ê¸° ìœ„í•œ í•¨ìˆ˜ í˜¸ì¶œ
```c
	while(1){
		/* -----ê±°ë¦¬ ì¸¡ì •----- */
		
		// ì™¼ìª½ ì´ˆìŒíŒŒ ì„¼ì„œ ì¸¡ì •
		digitalWrite(TRIGGER_LEFT, LOW);
		usleep(10);
		digitalWrite(TRIGGER_LEFT, HIGH);
		usleep(10);
		digitalWrite(TRIGGER_LEFT, LOW);

		struct timeval start, stop;
		while (digitalRead(ECHO_LEFT) == 0) {	// í„ìŠ¤ ë°œìƒ
			gettimeofday(&start, NULL);
		}
		while (digitalRead(ECHO_LEFT) == 1) {	// í„ìŠ¤ ëŒì•„ì˜´
			gettimeofday(&stop, NULL);
		}
		// ë¦¬í„´ íˆ¬ íƒ€ì„ = (endì‹œê°„ - startì‹œê°„)
		double elapsedTime = (stop.tv_sec - start.tv_sec) * 1000000 + (stop.tv_usec - start.tv_usec);
		// ì™¼ìª½ ì´ˆìŒíŒŒì˜ ê±°ë¦¬ ê°’
		double distance_left = elapsedTime * (34000.0 / 2.0) / 1000000.0;  // ì†ë„ë¥¼ cm/usë¡œ ë³€í™˜
		
		/* -----ë¶€ì € ë°œìƒ----- */
		
		// ì™¼ìª½ buzzer ìš¸ë¦¬ê¸°
		playBuzzer(LEFT_BUZZER_PIN, distance_left);

		//sleep(1);
		//usleep(1000000);  // 1ì´ˆ ëŒ€ê¸°
		
		/* -----ê±°ë¦¬ ì¸¡ì •----- */
		
		// ê°€ìš´ë° ì´ˆìŒíŒŒ ì„¼ì„œ ì¸¡ì •
		digitalWrite(TRIGGER_MIDDLE, LOW);
		usleep(10);
		digitalWrite(TRIGGER_MIDDLE, HIGH);
		usleep(10);
		digitalWrite(TRIGGER_MIDDLE, LOW);

		while (digitalRead(ECHO_MIDDLE) == 0) {
			gettimeofday(&start, NULL);
		}
		while (digitalRead(ECHO_MIDDLE) == 1) {
			gettimeofday(&stop, NULL);
		}
		elapsedTime = (stop.tv_sec - start.tv_sec) * 1000000 + (stop.tv_usec - start.tv_usec);
		double distance_middle = elapsedTime * (34000.0 / 2.0) / 1000000.0;  // ì†ë„ë¥¼ cm/usë¡œ ë³€í™˜
		
		/* -----ë¶€ì € ë°œìƒ----- */
		
		// ì™¼ìª½, ì˜¤ë¥¸ìª½ buzzer ìš¸ë¦¬ê¸°
		playBuzzer(LEFT_BUZZER_PIN, distance_middle);
		playBuzzer(RIGHT_BUZZER_PIN, distance_middle);

		/* -----ê±°ë¦¬ ì¸¡ì •----- */
		
		// ì˜¤ë¥¸ìª½ ì´ˆìŒíŒŒ ì„¼ì„œ ì¸¡ì •
		digitalWrite(TRIGGER_RIGHT, LOW);
		usleep(10);
		digitalWrite(TRIGGER_RIGHT, HIGH);
		usleep(10);
		digitalWrite(TRIGGER_RIGHT, LOW);

		while (digitalRead(ECHO_RIGHT) == 0) {
			gettimeofday(&start, NULL);
		}
		while (digitalRead(ECHO_RIGHT) == 1) {
			gettimeofday(&stop, NULL);
		}
		elapsedTime = (stop.tv_sec - start.tv_sec) * 1000000 + (stop.tv_usec - start.tv_usec);
		double distance_right = elapsedTime * (34000.0 / 2.0) / 1000000.0;  // ì†ë„ë¥¼ cm/usë¡œ ë³€í™˜
		
		/* -----ë¶€ì € ë°œìƒ----- */
		
		// ì˜¤ë¥¸ìª½ buzzer ìš¸ë¦¬ê¸°
		playBuzzer(RIGHT_BUZZER_PIN, distance_right);


		// 1ì´ˆë§ˆë‹¤ ê±°ë¦¬ê°’ ì¸¡ì • ë° ê°±ì‹ 
		sleep(0.05);
		// ì‹¤ì‹œê°„ìœ¼ë¡œ ê±°ë¦¬ ì¸¡ì • ì¶œë ¥
		printf("-----Distance----- \nLeft: %.2f cm \nMiddle: %.2f cm \nRight: %.2f cm\n\n", distance_left, distance_middle, distance_right);

	}

    
    return 0;
}
```
---
### ì¹´ë©”ë¼ë¥¼ í†µí•´ ì‚¬ë¬¼ì„ ì¸ì‹í•˜ê³  ì•Œë¦¼
* ì²´ë ¥ì— ë”°ë¼ ì €í•˜ë˜ëŠ” ì‹œê° ì¸ì§€ ê¸°ëŠ¥ì„ ëŒ€ì‹ í•˜ê¸° ìœ„í•´ ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ Google Cloud Vision APIë¥¼ í™œìš©í•œë‹¤. Google Cloud Vision APIë€ êµ¬ê¸€ì—ì„œ ì œê³µí•´ì£¼ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ì˜ ì´ë¯¸ì§€ ë¶„ì„ APIì´ë‹¤.
* ì‚¬ë¬¼ì„ ì¸ì‹í•˜ì—¬ í•´ë‹¹ ê°ì²´ê°€ ë¬´ì—‡ì¸ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìŒì„±ìœ¼ë¡œ ì¶œë ¥í•˜ì—¬ ì•ˆë‚´í•˜ê¸° ìœ„í•´ì„œëŠ” í…ìŠ¤íŠ¸ë¥¼ ìŒì„±ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ Googleì˜ Text-to-Speech APIì¸ gTTSë¥¼ ì‚¬ìš©í•œë‹¤.
---

â†’ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ ì–¸, Google API ì‚¬ìš©
```python
 import argparse
 import base64
 import httplib2
 import logging

 import picamera
 import numpy as np
 from gtts import gTTS
 from subprocess import call
 from time import sleep


 from googleapiclient import discovery
 from oauth2client.service_account import ServiceAccountCredentials
 from httplib2 import Http

DISCOVERY_URL='https://{api}.googleapis.com/$discovery/rest?version={apiVersion}'
```
---
â†’ gTTs ìŒì„±ì•ˆë‚´ ì‚¬ìš©
```python
 def playTTS(label):
    """Play the label"""
    tts = gTTS(text=label, lang='en')   # lang='ko'
    tts.save('result.mp3')
    call(['mplayer', 'result.mp3'])


def main(photo_file):
    """Run a label request on a single image"""

    # [START authenticate]
#    credentials = GoogleCredentials.get_application_default()
    scopes = ['https://www.googleapis.com/auth/cloud-platform']
    credentials = ServiceAccountCredentials.from_json_keyfile_name(
    '/home/alisa/key.json', scopes)
    http_auth = credentials.authorize(Http())
    service = discovery.build('vision', 'v1', credentials=credentials,
                              discoveryServiceUrl=DISCOVERY_URL)

    # [END authenticate]

    # [START construct_request]
    with open(photo_file, 'rb') as image:
        image_content = base64.b64encode(image.read())
        service_request = service.images().annotate(body={
            'requests': [{
                'image': {
                    'content': image_content.decode('UTF-8')
                },
                'features': [{
                    'type': 'LABEL_DETECTION',
                    'maxResults': 10
                }]
            }]
        })
        # [END construct_request]
        # [START parse_response]
        response = service_request.execute()
        label = response['responses'][0]['labelAnnotations'][0]['description']
        print(response)
        
        # ìŒì„±ì•ˆë‚´ í•¨ìˆ˜ í˜¸ì¶œ
        playTTS(label)

        print('Found label: %s for %s' % (label, photo_file))
        return 0
        # [END parse_response]

# [START run_application]
if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('image_file', help='The image you\'d like to label.')
    args = parser.parse_args()
    main(args.image_file)
# [END run_application]
```
---




## Result
### ì´ˆìŒíŒŒ ì„¼ì„œì™€ ë¶€ì €

ğŸ”ŠğŸ”ŠğŸ”Š


https://github.com/YoungWoon-Go/OSS_project/assets/144092472/9bfed4c2-ca12-4fa8-ae06-918ab32e483b



### ì¹´ë©”ë¼ì™€ ìŒì„± ì•ˆë‚´
![image](https://github.com/YoungWoon-Go/OSS_project/assets/144092472/6498b4e4-b209-4694-ad60-e01316eac236)
![image](https://github.com/YoungWoon-Go/OSS_project/assets/144092472/5d7400d0-88ee-4fd6-abb9-605acf522cf1)
<img width="791" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-11-28 á„‹á…©á„’á…® 10 47 54" src="https://github.com/YoungWoon-Go/OSS_project/assets/144092472/e863945d-881f-4c67-a3a2-f1251a56b1a0">

![image](https://github.com/YoungWoon-Go/OSS_project/assets/144092472/d2d42765-a37c-494f-803a-0f39678f1458)

<img width="791" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-11-28 á„‹á…©á„’á…® 10 49 14" src="https://github.com/YoungWoon-Go/OSS_project/assets/144092472/d7ad32e0-3070-4e35-a8b6-dd9248a037f1">

![image](https://github.com/YoungWoon-Go/sports-smart-goggles-using-raspberry-pie/assets/144092472/87fc6ab9-f555-4cd2-8020-d28667ca000f)
<img width="839" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-11-28 á„‹á…©á„’á…® 10 50 29" src="https://github.com/YoungWoon-Go/OSS_project/assets/144092472/00a82631-d92a-4a82-b94f-0c4f737fbd03">





## References
* https://andjjip.tistory.com/242 (ë¼ì¦ˆë² ë¦¬íŒŒì´ PWM, ì´ˆìŒíŒŒì„¼ì„œ, í›„ë°©ê°ì§€ì„¼ì„œ êµ¬í˜„)
* https://m.blog.naver.com/rldhkstopic/221516784267 (ë¼ì¦ˆë² ë¦¬íŒŒì´ ì´ˆìŒíŒŒ ì„¼ì„œ 3ê°œ ì´ìš©í•˜ê¸°)
* https://m.blog.naver.com/roboholic84/221623436924 (ë¼ì¦ˆë² ë¦¬íŒŒì´ì™€ í”¼ì—ì¡° ë¶€ì € ì‚¬ìš©í•˜ê¸°)
* https://www.raspberrypi.com/documentation/computers/camera_software.html
  (Camera software Introducing the Raspberry Pi Cameras)
* https://www.dexterindustries.com/howto/use-google-cloud-vision-on-the-raspberry-pi/
  (Use Google Cloud Vision On the Raspberry Pi and GoPiGo)
* https://neosarchizo.gitbooks.io/raspberrypiforsejonguniv/content/chapter4.html (Pi camera)
